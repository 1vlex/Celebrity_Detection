# Детекция знаменитостей / пайплайн сбора датасета лиц

Это небольшая исследовательская работа в Jupyter-ноутбуке, которая строит воспроизводимый пайплайн
по сбору и подготовке датасета кропов лиц выбранных публичных персон
(стримеры, блогеры, про-игроки и т.п.).

Основная идея:

1. Задать список людей + ссылки на прототипные фото и видео (через CSV).
2. Скачать прототипы и видео.
3. Нарезать фрагменты видео по заданным таймкодам.
4. Извлечь кадры, найти лица и посчитать эмбеддинги через **InsightFace**.
5. Верифицировать лица по прототипу, отфильтровать мусор.
6. Сделать дедупликацию похожих кропов.
7. Оценить качество датасета (UMAP, NN-purity, silhouette).
8. Упаковать готовый датасет в ZIP.

Ноутбук ориентирован на запуск в окружении типа Colab / локальная машина с GPU,
но может работать и на CPU (медленнее).

---

## Структура проекта

Минимальный вариант репозитория:

```text
.
├─ Детекция_знаменитостей.ipynb   # основной ноутбук
├─ README.md                      # это описание
├─ requirements.txt               # Python-зависимости
└─ .gitignore                     # игнор всего тяжёлого/служебного
```

Все рабочие папки для данных создаются автоматически в ноутбуке через `Path`
(например, `raw`, `fragments`, `frames`, `crops`, `meta` и т.п.).
Их не нужно создавать руками — они будут появляться при первом запуске кода.

---

## Зависимости

Основные библиотеки, которые использует ноутбук:

- `numpy`, `pandas`
- `matplotlib`
- `tqdm`
- `opencv-python-headless` (модуль `cv2`)
- `insightface` + `onnxruntime-gpu`
- `umap-learn`
- `scikit-learn`
- `python-slugify`
- `yt-dlp`
- `datasets`, `huggingface_hub` (зарезервировано под работу с HF, можно отключить при необходимости)
- плюс сам Jupyter

Системные утилиты:

- **ffmpeg** - для нарезки видеофрагментов
- **yt-dlp** ставится через `pip`, но при желании можно поставить и как системный бинарь

Все Python-зависимости собраны в `requirements.txt`.

---

## Как запустить локально

```bash
# 1. Клонируем репозиторий
git clone https://github.com/1vlex/Celebrity_Detection.git
cd Celebrity_Detection

# 2. (опционально) создаём виртуальное окружение
python -m venv .venv
source .venv/bin/activate  # Windows: .venv\Scripts\activate

# 3. Ставим зависимости
pip install --upgrade pip
pip install -r requirements.txt

# 4. Убедиться, что ffmpeg есть в системе
ffmpeg -version  # если команда не найдена - установить ffmpeg через пакетный менеджер

# 5. Запускаем Jupyter
jupyter notebook
# и открываем ноутбук "Детекция_знаменитостей.ipynb"
```

---

## CSV c персоналиями

В начале ноутбука создаётся пример `people.csv` со столбцами:

- `person_id`
- `name`
- `proto_image_url`
- `video_url_1`
- `start_1`
- `end_1`

Ты можешь:

- оставить пример как есть, или  
- заменить содержимое CSV под своих людей и видео.

Ноутбук дальше построен так, чтобы pipeline работал от этого CSV.

---

## Выходные данные

В процессе работы ноутбук:

- скачивает **прототипы** лиц и **видео**,
- режет видео на фрагменты,
- извлекает **кропы лиц** и метаданные,
- считает эмбеддинги, делает дедупликаты,
- строит UMAP / метрики качества,
- собирает архив с итоговым датасетом лиц (`celebs_dataset.zip`).

